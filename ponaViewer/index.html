<!DOCTYPE html>
<html lang="en">
  <head>
    <title>得见全景图_测试</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <style>
      body {
        background-color: #000000;
        margin: 0px;
        overflow: hidden;
        touch-action: none;
      }

      button{

        position: absolute;
        left:30px;

      }


    </style>
  </head>
  <body>

    <button id="xxx" onclick="switchVR()">VR模式</button>
    <div id="container"></div>
 

    <script src="three.min.js"></script>
    <script src="OrbitControls.js"></script>
    <script src="DeviceOrientationControls.js"></script>

    <script>


      window.onload = function () {
        document.body.addEventListener('touchmove', function (e) {
          e.preventDefault()
          //阻止默认的处理方式(阻止下拉滑动的效果)
        }, {passive: false})
      }

      var camera, scene, renderer,controls,controlsDevice;


      init();
      animate();

      function init() {

        var container, mesh;

        container = document.getElementById( 'container' );

        camera = new THREE.PerspectiveCamera( 60, window.innerWidth / window.innerHeight, 1, 1100 );
        // camera.target = new THREE.Vector3( 1, 0, 1 );

        scene = new THREE.Scene();

        var geometry = new THREE.SphereBufferGeometry( 500, 60, 40 );
        // invert the geometry on the x-axis so that all of the faces point inward
        geometry.scale( - 1, 1, 1 );

        var texture = new THREE.TextureLoader().load( 'a.jpg' );
        // texture.magFilter = THREE.NearestFilter;

        var material = new THREE.MeshBasicMaterial( {
          map: texture
        } );

        mesh = new THREE.Mesh( geometry, material );

        scene.add( mesh );

        renderer = new THREE.WebGLRenderer();
        renderer.setPixelRatio( window.devicePixelRatio );
        renderer.setSize( window.innerWidth, window.innerHeight );
        container.appendChild( renderer.domElement );


        


        // controls

        controls = new THREE.OrbitControls( camera, renderer.domElement );

        controls.enableDamping = true; // an animation loop is required when either damping or auto-rotation are enabled
        controls.dampingFactor = 0.25;
        controls.minDistance = 50;
        controls.maxDistance = 200;
        controls.target.set(0.1,0,0);
        controls.rotateSpeed = 0.3;
        controls.autoRotate = true;
        controls.autoRotateSpeed = 0.2;
        controls.enabled = true;


        // controlsDevice
        controlsDevice = new THREE.DeviceOrientationControls( camera );
        controlsDevice.enabled = false;
        // controlsDevice.disconnect();
                                                                
      
        window.addEventListener( 'resize', onWindowResize, false );

      }

      function switchVR(){

        console.log("11111");

        controlsDevice.enabled = !controlsDevice.enabled;
        controls.enabled = !controls.enabled;
        // if(controlsDevice.enabled){
        //   controlsDevice.connect();

        // }else{
        //   controlsDevice.disconnect();
        // }
      }

      function onWindowResize() {


        setTimeout(function() {

          camera.aspect = window.innerWidth / window.innerHeight;
          camera.updateProjectionMatrix();

          renderer.setSize( window.innerWidth, window.innerHeight );
        },300);
        
      }



   

      function animate() {

        requestAnimationFrame( animate );
        update();

      }

      function update() {

        controlsDevice.update(); 
        controls.enabled&&controls.update(); 
        renderer.render( scene, camera );

      }

    </script>
  </body>
</html>
